(()=>{var e={};e.id=888,e.ids=[888],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},45832:(e,a,t)=>{"use strict";t.r(a),t.d(a,{GlobalError:()=>r.a,__next_app__:()=>m,originalPathname:()=>u,pages:()=>d,routeModule:()=>h,tree:()=>c}),t(73933),t(55194),t(96560);var n=t(23191),s=t(88716),i=t(37922),r=t.n(i),o=t(95231),l={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>o[e]);t.d(a,l);let c=["",{children:["obras",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,73933)),"/home/ubuntu/erp-obra-principal/app/obras/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,55194)),"/home/ubuntu/erp-obra-principal/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.bind(t,96560)),"/home/ubuntu/erp-obra-principal/app/not-found.tsx"]}],d=["/home/ubuntu/erp-obra-principal/app/obras/page.tsx"],u="/obras/page",m={require:t,loadChunk:()=>Promise.resolve()},h=new n.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/obras/page",pathname:"/obras",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},89482:(e,a,t)=>{Promise.resolve().then(t.bind(t,26398))},26398:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var n=t(10326),s=t(17577),i=t.n(s),r=t(35047),o=t(12796),l=t(35650),c=t(43058);function d(){let e=(0,r.useRouter)(),[a,t]=(0,s.useState)([]),[c,d]=(0,s.useState)(!0),[u,m]=(0,s.useState)(null),[h,p]=(0,s.useState)(!1),[x,j]=(0,s.useState)(!1),[g,b]=(0,s.useState)(null),[v,f]=(0,s.useState)(null),[_,y]=(0,s.useState)({status:"",cliente:""}),[N,C]=(0,s.useState)({codigo:"",nome:"",descricao:"",cliente:"",data_inicio:"",data_fim_prevista:"",orcamento_total:"",status:"planejamento"}),w=i().useCallback(async()=>{try{d(!0),m(null);let e={};_.status&&(e.status=_.status),_.cliente&&(e.cliente=_.cliente);let a=await (0,o.N_)(Object.keys(e).length>0?e:void 0);t(a)}catch(e){m(e.message||"Erro ao carregar obras"),console.error("Erro ao carregar obras:",e)}finally{d(!1)}},[_.status,_.cliente]),S=e=>{f(e.id),p(!0),C({codigo:e.codigo,nome:e.nome,descricao:e.descricao||"",cliente:e.cliente||"",data_inicio:e.data_inicio?new Date(e.data_inicio).toISOString().split("T")[0]:"",data_fim_prevista:e.data_fim_prevista?new Date(e.data_fim_prevista).toISOString().split("T")[0]:"",orcamento_total:e.orcamento_total?.toString()||"",status:e.status})},E=()=>{p(!1),f(null)},P=e=>{let{name:a,value:t}=e.target;C(e=>({...e,[a]:t}))},F=async()=>{try{if(j(!0),m(null),!N.codigo||!N.nome){m("C\xf3digo e Nome s\xe3o obrigat\xf3rios");return}let e={codigo:N.codigo,nome:N.nome,descricao:N.descricao||void 0,cliente:N.cliente||void 0,data_inicio:N.data_inicio?new Date(N.data_inicio):void 0,data_fim_prevista:N.data_fim_prevista?new Date(N.data_fim_prevista):void 0,orcamento_total:N.orcamento_total?parseFloat(N.orcamento_total):void 0,status:N.status};v?await (0,o.y5)(v,e):await (0,o.AE)(e),p(!1),f(null),await w()}catch(e){m(e.message||"Erro ao salvar obra"),console.error("Erro ao salvar obra:",e)}finally{j(!1)}},D=async(e,a)=>{if(window.confirm(`Tem certeza que deseja excluir a obra "${a}"?

Esta a\xe7\xe3o n\xe3o pode ser desfeita.`))try{b(e),m(null),await (0,o.gQ)(e),await w()}catch(e){m(e.message||"Erro ao excluir obra"),console.error("Erro ao excluir obra:",e)}finally{b(null)}},k=(e,a)=>{y(t=>({...t,[e]:a}))},A=e=>e?("string"==typeof e?new Date(e):e).toLocaleDateString("pt-BR"):"-",O=e=>e?new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e):"-",T=e=>({planejamento:"#9CA3AF",em_andamento:"#3B82F6",pausada:"#F59E0B",concluida:"#10B981",cancelada:"#EF4444"})[e]||"#9CA3AF";return(0,n.jsxs)("div",{className:"obras-page",children:[(0,n.jsxs)("div",{className:"obras-header",children:[n.jsx("h1",{children:"Gest\xe3o de Obras"}),(0,n.jsxs)("div",{className:"header-actions",children:[n.jsx("button",{className:"btn-primary",onClick:()=>{f(null),p(!0),C({codigo:"",nome:"",descricao:"",cliente:"",data_inicio:"",data_fim_prevista:"",orcamento_total:"",status:"planejamento"})},children:"+ Nova Obra"}),n.jsx("button",{className:"btn-logout",onClick:async()=>{try{await (0,l.kS)(),e.push("/login")}catch(a){e.push("/login")}},children:"Sair"})]})]}),(0,n.jsxs)("div",{className:"filters-container",children:[(0,n.jsxs)("div",{className:"filter-group",children:[n.jsx("label",{htmlFor:"filter-status",children:"Status"}),(0,n.jsxs)("select",{id:"filter-status",value:_.status,onChange:e=>k("status",e.target.value),className:"filter-select",children:[n.jsx("option",{value:"",children:"Todos"}),n.jsx("option",{value:"planejamento",children:"Planejamento"}),n.jsx("option",{value:"em_andamento",children:"Em Andamento"}),n.jsx("option",{value:"pausada",children:"Pausada"}),n.jsx("option",{value:"concluida",children:"Conclu\xedda"}),n.jsx("option",{value:"cancelada",children:"Cancelada"})]})]}),(0,n.jsxs)("div",{className:"filter-group",children:[n.jsx("label",{htmlFor:"filter-cliente",children:"Cliente"}),n.jsx("input",{type:"text",id:"filter-cliente",value:_.cliente,onChange:e=>k("cliente",e.target.value),placeholder:"Filtrar por cliente...",className:"filter-input"})]})]}),u&&n.jsx("div",{className:"error-message",children:u}),c&&n.jsx("div",{className:"loading",children:"Carregando obras..."}),!c&&n.jsx("div",{className:"obras-table-container",children:(0,n.jsxs)("table",{className:"obras-table",children:[n.jsx("thead",{children:(0,n.jsxs)("tr",{children:[n.jsx("th",{children:"C\xf3digo"}),n.jsx("th",{children:"Nome"}),n.jsx("th",{children:"Cliente"}),n.jsx("th",{children:"Status"}),n.jsx("th",{children:"Data In\xedcio"}),n.jsx("th",{children:"Data Fim Prevista"}),n.jsx("th",{children:"Or\xe7amento Total"}),n.jsx("th",{children:"A\xe7\xf5es"})]})}),n.jsx("tbody",{children:0===a.length?n.jsx("tr",{children:n.jsx("td",{colSpan:8,className:"empty-state",children:"Nenhuma obra encontrada"})}):a.map(a=>(0,n.jsxs)("tr",{children:[n.jsx("td",{children:a.codigo}),n.jsx("td",{children:a.nome}),n.jsx("td",{children:a.cliente||"-"}),n.jsx("td",{children:n.jsx("span",{className:"status-badge",style:{backgroundColor:T(a.status)},children:a.status})}),n.jsx("td",{children:A(a.data_inicio)}),n.jsx("td",{children:A(a.data_fim_prevista)}),n.jsx("td",{children:O(a.orcamento_total)}),n.jsx("td",{children:(0,n.jsxs)("div",{className:"action-buttons",children:[n.jsx("button",{className:"btn-view",onClick:()=>e.push(`/obras/${a.id}`),title:"Ver detalhes",children:"\uD83D\uDC41️"}),n.jsx("button",{className:"btn-edit",onClick:()=>S(a),title:"Editar obra",children:"✏️"}),n.jsx("button",{className:"btn-delete",onClick:()=>D(a.id,a.nome),disabled:g===a.id,title:"Excluir obra",children:g===a.id?"...":"\uD83D\uDDD1️"})]})})]},a.id))})]})}),h&&(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{className:"drawer-overlay",onClick:E}),(0,n.jsxs)("div",{className:"drawer",children:[(0,n.jsxs)("div",{className:"drawer-header",children:[n.jsx("h2",{children:v?"Editar Obra":"Nova Obra"}),n.jsx("button",{className:"drawer-close",onClick:E,children:"\xd7"})]}),(0,n.jsxs)("div",{className:"drawer-content",children:[(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"codigo",children:"C\xf3digo *"}),n.jsx("input",{type:"text",id:"codigo",name:"codigo",value:N.codigo,onChange:P,required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"nome",children:"Nome *"}),n.jsx("input",{type:"text",id:"nome",name:"nome",value:N.nome,onChange:P,required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"descricao",children:"Descri\xe7\xe3o"}),n.jsx("textarea",{id:"descricao",name:"descricao",value:N.descricao,onChange:P,rows:3})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"cliente",children:"Cliente"}),n.jsx("input",{type:"text",id:"cliente",name:"cliente",value:N.cliente,onChange:P})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"data_inicio",children:"Data In\xedcio"}),n.jsx("input",{type:"date",id:"data_inicio",name:"data_inicio",value:N.data_inicio,onChange:P})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"data_fim_prevista",children:"Data Fim Prevista"}),n.jsx("input",{type:"date",id:"data_fim_prevista",name:"data_fim_prevista",value:N.data_fim_prevista,onChange:P})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"orcamento_total",children:"Or\xe7amento Total"}),n.jsx("input",{type:"number",id:"orcamento_total",name:"orcamento_total",value:N.orcamento_total,onChange:P,step:"0.01",min:"0"})]}),(0,n.jsxs)("div",{className:"form-group",children:[n.jsx("label",{htmlFor:"status",children:"Status"}),(0,n.jsxs)("select",{id:"status",name:"status",value:N.status,onChange:P,children:[n.jsx("option",{value:"planejamento",children:"Planejamento"}),n.jsx("option",{value:"em_andamento",children:"Em Andamento"}),n.jsx("option",{value:"pausada",children:"Pausada"}),n.jsx("option",{value:"concluida",children:"Conclu\xedda"}),n.jsx("option",{value:"cancelada",children:"Cancelada"})]})]})]}),(0,n.jsxs)("div",{className:"drawer-footer",children:[n.jsx("button",{className:"btn-secondary",onClick:E,disabled:x,children:"Cancelar"}),n.jsx("button",{className:"btn-primary",onClick:F,disabled:x,children:x?"Salvando...":"Salvar"})]})]})]})]})}function u(){return n.jsx(c.i,{children:n.jsx(d,{})})}t(37891)},43058:(e,a,t)=>{"use strict";t.d(a,{i:()=>r});var n=t(10326),s=t(17577),i=t(35047);function r({children:e}){(0,i.useRouter)(),(0,i.usePathname)();let[a,t]=(0,s.useState)(!0),[r,o]=(0,s.useState)(!1);return a?n.jsx("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#1a1a1a",color:"#e5e5e5"},children:n.jsx("div",{children:"Verificando autentica\xe7\xe3o..."})}):r?n.jsx(n.Fragment,{children:e}):null}},18069:(e,a,t)=>{"use strict";function n(e,a){}function s(){}async function i(e,a={}){let t={"Content-Type":"application/json",...a.headers},n=await fetch(`https://erp-obra-principal.onrender.com/api${e}`,{...a,headers:t});if(n.status,!n.ok)throw Error((await n.json().catch(()=>({}))).message||`Erro ${n.status}: ${n.statusText}`);return n.json()}t.d(a,{Fm:()=>n,hi:()=>r,yE:()=>s});let r={get:(e,a)=>i(e,{...a,method:"GET"}),post:(e,a,t)=>i(e,{...t,method:"POST",body:a?JSON.stringify(a):void 0}),put:(e,a,t)=>i(e,{...t,method:"PUT",body:a?JSON.stringify(a):void 0}),delete:(e,a)=>i(e,{...a,method:"DELETE"})}},35650:(e,a,t)=>{"use strict";t.d(a,{kS:()=>i,x4:()=>s});var n=t(18069);async function s(e){let a=await n.hi.post("/auth/login",e);return(0,n.Fm)(a.access_token,a.refresh_token),a}async function i(){try{await n.hi.post("/auth/logout")}catch(e){console.error("Erro ao fazer logout:",e)}finally{(0,n.yE)()}}},12796:(e,a,t)=>{"use strict";t.d(a,{AE:()=>r,Gf:()=>i,N_:()=>s,gQ:()=>l,y5:()=>o});var n=t(18069);async function s(e){let a=new URLSearchParams;e?.status&&a.append("status",e.status),e?.cliente&&a.append("cliente",e.cliente),e?.includeDeleted&&a.append("includeDeleted","true");let t=a.toString(),s=`/obras${t?`?${t}`:""}`;return n.hi.get(s)}async function i(e){return n.hi.get(`/obras/${e}`)}async function r(e){return n.hi.post("/obras",e)}async function o(e,a){return n.hi.put(`/obras/${e}`,a)}async function l(e){return n.hi.delete(`/obras/${e}`)}},73933:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>n});let n=(0,t(68570).createProxy)(String.raw`/home/ubuntu/erp-obra-principal/app/obras/page.tsx#default`)},37891:()=>{}};var a=require("../../webpack-runtime.js");a.C(e);var t=e=>a(a.s=e),n=a.X(0,[92,953,276],()=>t(45832));module.exports=n})();